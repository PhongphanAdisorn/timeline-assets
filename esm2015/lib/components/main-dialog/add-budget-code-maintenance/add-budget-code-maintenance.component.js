import { __awaiter } from "tslib";
import { ChangeDetectorRef, Component, Inject, NgZone } from '@angular/core';
import { FormControl, Validators } from '@angular/forms';
import { DateAdapter, MAT_DATE_FORMATS } from '@angular/material/core';
import { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';
import { debounceTime, distinctUntilChanged, map } from 'rxjs/operators';
import { IconFiles } from '../../../common/icon-files';
import { UserAuthedService } from '../../../services/user-auth.service';
import { AppTools, BudgetCodeService } from '../../../timeline-assets.service';
import { FadeInGrow, FadeInOut } from './create-event.animation';
const CUSTOM_DATE_FORMATS = {
    parse: {
        dateInput: { month: 'short', year: 'numeric', day: 'numeric' },
    },
    display: {
        dateInput: { month: 'short', year: 'numeric', day: 'numeric' },
        monthYearLabel: { year: 'numeric', month: 'numeric' },
        dateA11yLabel: { year: 'numeric', month: 'long', day: 'numeric' },
        monthYearA11yLabel: { year: 'numeric', month: 'long' },
    }
};
const ɵ0 = CUSTOM_DATE_FORMATS;
export class AddBudgetCodeMaintenanceComponent {
    constructor(_ref, _zone, _dialog, data, _dateAdapter, _authed, _budgetCodeAPI) {
        this._ref = _ref;
        this._zone = _zone;
        this._dialog = _dialog;
        this._dateAdapter = _dateAdapter;
        this._authed = _authed;
        this._budgetCodeAPI = _budgetCodeAPI;
        this.dialogType = 'Viewer';
        this.currentDate = new FormControl(new Date(), [Validators.required]);
        this.searchBudgetCode = new FormControl(null, [Validators.required]);
        this.searchAsset = new FormControl(null);
        this.selectedOptions = new FormControl(new Array(), [Validators.required]);
        this.listBudgetCode = new Array();
        this.assetsUseBudgetCode = new Array();
        // public listGeomCopy: Array<any> = new Array();
        this.listGeom = new Array();
        this.filesUpload = new Array();
        /** Subscription */
        this._subscription = {};
        this._dateAdapter.setLocale('th-TH');
        // console.log('Dialog-Data:', data);
        this.title = data === null || data === void 0 ? void 0 : data.title;
        this.assetTable = data === null || data === void 0 ? void 0 : data.assetTable;
        this.dialogType = data === null || data === void 0 ? void 0 : data.dialogType;
        this.listGeom = this.mapFormat(data === null || data === void 0 ? void 0 : data.listGeom);
        if (data === null || data === void 0 ? void 0 : data.budgetCode)
            this.getViewBudgetCode(data === null || data === void 0 ? void 0 : data.budgetCode);
        // this.listGeomCopy = this.listGeom.filter(o => o?.id);
        // const selected = this.listGeom.filter(o => [7407, 7410, 7412].includes(o?.id));
        // this.selectedOptions.setValue(selected);
    }
    ngOnInit() {
        this.filteredAssets = this.searchAsset.valueChanges.pipe(debounceTime(400), distinctUntilChanged(), map(value => {
            const keyword = value.toLowerCase();
            if (keyword === null || keyword === void 0 ? void 0 : keyword.length)
                return this.listGeom.filter(obj => obj.title.toLowerCase().indexOf(keyword) !== -1);
            return this.listGeom.slice();
        }));
    }
    ngAfterViewInit() {
        this.searchAsset.setValue('', { emitEvent: true }); //-- Trigger asset search box
        this._subscription.searchBudgetCode = this.searchBudgetCode.valueChanges.pipe(debounceTime(400), distinctUntilChanged()).subscribe(value => {
            var _a;
            if ((_a = this.activeBudgetCode) === null || _a === void 0 ? void 0 : _a.budgetCode) {
                this.activeBudgetCode = null;
                this.selectedOptions.setValue([]);
                this._ref.detectChanges();
            }
        });
    }
    ngOnDestroy() {
        this._dateAdapter.setLocale('en-EN');
        for (const key in this._subscription) {
            if (Object.prototype.hasOwnProperty.call(this._subscription, key))
                this._subscription[key].unsubscribe();
        }
    }
    mapFormat(arr) {
        return arr.sort((a, b) => {
            const sA = (a === null || a === void 0 ? void 0 : a.skm) ? Number(String(a === null || a === void 0 ? void 0 : a.skm).replace('+', '.')) : Number(String(a === null || a === void 0 ? void 0 : a.km_location).replace('+', '.'));
            const sB = (b === null || b === void 0 ? void 0 : b.skm) ? Number(String(b === null || b === void 0 ? void 0 : b.skm).replace('+', '.')) : Number(String(b === null || b === void 0 ? void 0 : b.km_location).replace('+', '.'));
            return (sB < sA) ? 1 : -1;
        });
    }
    /** Handler Form */
    setFormDisabled() {
        this.currentDate.disable();
        this.searchBudgetCode.disable();
        this.selectedOptions.disable();
    }
    setFormEnabled() {
        this.currentDate.enable();
        this.searchBudgetCode.enable();
        this.selectedOptions.enable();
    }
    getViewBudgetCode(budgetCode) {
        this.preLoading = true;
        this._budgetCodeAPI.findBudgetCode(false, this.assetTable, budgetCode).then(res => {
            var _a;
            if (res === null || res === void 0 ? void 0 : res.length) {
                this.setActiveBudgetCode(res[0]);
                const reportDate = (_a = res[0]) === null || _a === void 0 ? void 0 : _a.reportDate;
                this.searchBudgetCode.setValue(budgetCode, { emitEvent: false });
                this.currentDate.setValue(new Date(reportDate), { emitEvent: false });
            }
            this.preLoading = false;
        }, err => {
            this.preLoading = false;
        });
    }
    findingBudgetCode() {
        this.loadingSearch = true;
        this._budgetCodeAPI.findBudgetCode(true, this.assetTable, this.searchBudgetCode.value).then(res => {
            this.listBudgetCode = (res === null || res === void 0 ? void 0 : res.length) ? res : [];
            this.loadingSearch = false;
            this.errFindMessage = null;
        }, err => {
            var _a;
            this.errFindMessage = 'ไม่พบรหัสงประมาณ';
            this.listBudgetCode = new Array();
            this.loadingSearch = false;
            if ((_a = this.activeBudgetCode) === null || _a === void 0 ? void 0 : _a.budgetCode) {
                this.activeBudgetCode = null;
                this.selectedOptions.setValue([]);
                this._ref.detectChanges();
            }
        });
    }
    getAssetUsedCode() {
        var _a;
        this.preLoading = true;
        this._budgetCodeAPI.getAssetUsedCode((_a = this.activeBudgetCode) === null || _a === void 0 ? void 0 : _a.budgetCode).then(res => {
            this.assetsUseBudgetCode = (res === null || res === void 0 ? void 0 : res.length) ? res : [];
            if (res === null || res === void 0 ? void 0 : res.length) {
                let assetIds = this.assetsUseBudgetCode.filter(o => { var _a; return ((o === null || o === void 0 ? void 0 : o.assetTable) === this.assetTable && ((_a = o === null || o === void 0 ? void 0 : o.assets) === null || _a === void 0 ? void 0 : _a.length)); }).map(o => o.assets);
                assetIds = ((assetIds === null || assetIds === void 0 ? void 0 : assetIds.length) > 0) ? assetIds[0].map(o => o.assetId) : [];
                const selected = this.listGeom.filter(o => assetIds.includes(o === null || o === void 0 ? void 0 : o.id));
                if (selected === null || selected === void 0 ? void 0 : selected.length) {
                    this.selectedOptions.setValue(selected);
                    this._ref.detectChanges();
                }
            }
            this.preLoading = false;
        }, err => {
            this.preLoading = false;
        });
    }
    setActiveBudgetCode(budgetCode) {
        var _a, _b;
        if (((_a = this.activeBudgetCode) === null || _a === void 0 ? void 0 : _a.title) === (budgetCode === null || budgetCode === void 0 ? void 0 : budgetCode.title)) {
            this.activeBudgetCode = null;
            this.selectedOptions.setValue([]);
            this._ref.detectChanges();
            return;
        }
        this.activeBudgetCode = budgetCode;
        this.getAssetUsedCode();
        const assetIds = ((_b = budgetCode === null || budgetCode === void 0 ? void 0 : budgetCode.assetIds) === null || _b === void 0 ? void 0 : _b.length) ? budgetCode.assetIds : [];
        const selected = this.listGeom.filter(o => assetIds.includes(String(o === null || o === void 0 ? void 0 : o.id)));
        if (selected === null || selected === void 0 ? void 0 : selected.length)
            this.selectedOptions.setValue(selected);
    }
    /** ===============================================================================
       * File handlering
       * @param el
       */
    inputFiles(el) {
        const files = el.target.files;
        const filesArr = new Array();
        for (const file of files) {
            const extension = String(file.name).substring(String(file.name).lastIndexOf('.') + 1);
            const type = String(file.type).split('/')[0];
            const format = {
                thumb: null,
                name: file.name,
                file: file,
                size: file.size,
                progress: 0
            };
            if (file.type.match(/image\/*/) && type != 'svg') {
                this.readImage(format);
            }
            else {
                format.thumb = IconFiles.iconFile(String(extension).toLowerCase());
            }
            filesArr.unshift(format);
        }
        this._zone.run(() => __awaiter(this, void 0, void 0, function* () {
            this.filesUpload = [...filesArr, ...this.filesUpload];
        }));
    }
    /** Reander image file */
    readImage(file) {
        let previewUrl = '';
        const reader = new FileReader();
        reader.onload = (_event) => {
            file.thumb = reader.result;
        };
        reader.readAsDataURL(file.file);
        return file;
    }
    /** Display size type
     * 10 KB | MB | GB
    */
    readFileSize(size) {
        if (!size)
            return '';
        if (size <= ((Math.pow(2, 10)) * 1024))
            return `${(size / (Math.pow(2, 10))).toFixed(2)} KB`;
        if (size <= ((Math.pow(2, 20)) * 1024))
            return `${(size / (Math.pow(2, 20))).toFixed(2)} MB`;
        return `${(size / (Math.pow(2, 30))).toFixed(2)} GB`;
    }
    /** View extention */
    getFileIcon(extension, fileUrl) {
        const isImage = ['jpg', 'png', 'jpeg', 'gif', 'svg'].includes(String(extension).toLowerCase());
        if (isImage && fileUrl)
            return fileUrl;
        return IconFiles.iconFile(String(extension).toLowerCase());
    }
    /** Delete file item */
    delFile(position) {
        this.filesUpload.splice(position, 1);
    }
    /** Select item */
    selectionChanged(selected) {
        // console.log('selected:', selected, this.selectedOptions.value);
    }
    //---------------------------------------------------------------------------------------------------
    isImageSaved() {
        var _a, _b;
        if (this.isSaved && !((_a = this.filesUpload) === null || _a === void 0 ? void 0 : _a.length))
            return true;
        if (!((_b = this.filesUpload) === null || _b === void 0 ? void 0 : _b.length))
            return false;
        const saving = this.filesUpload.every(o => o.progress == 100);
        return saving;
    }
    saveData() {
        var _a, _b, _c, _d;
        if (this.isSaving)
            return;
        if (!((_a = this.selectedOptions.value) === null || _a === void 0 ? void 0 : _a.length))
            return;
        if (this.currentDate.invalid || this.searchBudgetCode.invalid)
            return;
        const tools = new AppTools();
        const assetIds = this.selectedOptions.value.filter(o => (o === null || o === void 0 ? void 0 : o.id)).map(o => String(o === null || o === void 0 ? void 0 : o.id));
        // console.log('Asset-Ids:', this.assetTable, this.searchBudgetCode.value, assetIds);
        const budgetCode = (_c = (_b = this.activeBudgetCode) === null || _b === void 0 ? void 0 : _b.budgetCode) !== null && _c !== void 0 ? _c : this.searchBudgetCode.value;
        const params = {
            assetType: this.assetTable,
            budgetCode: String(budgetCode).trim(),
            assetIds: assetIds,
            userId: (_d = this._authed.authUser) === null || _d === void 0 ? void 0 : _d.account_id,
            reportDate: tools.dateTimeFormat(this.currentDate.value)
        };
        this.isSaving = true;
        this.setFormDisabled();
        // return;
        console.log('Asset-Ids:', params);
        this._budgetCodeAPI.createWithUpdate(params).then(res => {
            this.isSaved = true;
            if (res === null || res === void 0 ? void 0 : res.budget_code)
                this.uploadAllFile(res === null || res === void 0 ? void 0 : res.budget_code);
        });
    }
    uploadAllFile(budgetCode) {
        let idxFile = 0;
        for (const item of this.filesUpload) {
            this._subscription[`upload-idx-${idxFile}`] = this._budgetCodeAPI.uploadFile(this.assetTable, budgetCode, item.file).subscribe(res => {
                if (typeof res === 'number') {
                    item.progress = res;
                }
            }, err => console.log('%cError occured while uploading file', 'color:tomato'));
            idxFile++;
        }
    }
    downloafFile(file) {
        const extract = String(file === null || file === void 0 ? void 0 : file.fileUrl).split('/');
        const fileName = extract[extract.length - 1];
        this._subscription.downloadFile = this._budgetCodeAPI.downloadFile(this.assetTable, fileName).subscribe(res => {
            if (typeof res === 'number') {
                file.progress = Math.round(100 * res / Number(file === null || file === void 0 ? void 0 : file.size)); //console.log('Percentag:', Math.round(100 * res / Number(file?.size)));
            }
            else if (res instanceof Blob) {
                this.downloadBlob(res, file === null || file === void 0 ? void 0 : file.fileName);
            }
        });
    }
    downloadBlob(blob, filename) {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename || 'download';
        document.body.appendChild(a);
        setTimeout(() => { a.click(); document.body.removeChild(a); }, 100);
    }
}
AddBudgetCodeMaintenanceComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-add-budget-code-maintenance',
                template: "<div mat-dialog-title>\n    <div fxLayout=\"row\" fxLayoutAlign=\"start center\" fxLayoutGap=\"16px\" [style.width.%]=\"100\">\n        <h4 *ngIf=\"dialogType === 'Editor'\" class=\"m-0\">\u0E01\u0E33\u0E2B\u0E19\u0E14\u0E23\u0E2B\u0E31\u0E2A\u0E07\u0E1A\u0E1B\u0E23\u0E30\u0E21\u0E32\u0E13\u0E43\u0E19\u0E01\u0E32\u0E23\u0E0B\u0E48\u0E2D\u0E21\u0E1A\u0E33\u0E23\u0E38\u0E07 {{ title }}</h4>\n        <h4 *ngIf=\"dialogType === 'Viewer'\" class=\"m-0\">\u0E23\u0E2B\u0E31\u0E2A\u0E07\u0E1A\u0E1B\u0E23\u0E30\u0E21\u0E32\u0E13\u0E43\u0E19\u0E01\u0E32\u0E23\u0E0B\u0E48\u0E2D\u0E21\u0E1A\u0E33\u0E23\u0E38\u0E07{{ title }}: {{\n            activeBudgetCode?.budgetCode }}</h4>\n        <span fxFlex></span>\n        <mat-icon *ngIf=\"dialogType === 'Viewer'\" [style.color]=\"'gray'\" mat-dialog-close>close</mat-icon>\n    </div>\n    <mat-progress-bar *ngIf=\"preLoading\" color=\"warn\" mode=\"indeterminate\" [style.height.px]=\"2\"></mat-progress-bar>\n</div>\n\n<mat-dialog-content class=\"w-100 h-100 m-0\">\n    <div fxLayout=\"row\" fxLayout.sm=\"column\" fxLayoutGap=\"16px\" class=\"w-100 h-100\">\n        <div fxLayout=\"column\" fxFlex=\"50%\" fxFlex.sm=\"65%\" class=\"h-100\">\n            <mat-form-field appearance=\"outline\" color=\"warn\" class=\"w-100\">\n                <mat-label>\u0E27\u0E31\u0E19\u0E17\u0E35\u0E48\u0E40\u0E1E\u0E34\u0E48\u0E21\u0E02\u0E49\u0E2D\u0E21\u0E39\u0E25</mat-label>\n                <input matInput [formControl]=\"currentDate\" [matDatepicker]=\"addDate\" readonly\n                    (click)=\"(dialogType === 'Editor') ? addDate.open() : null\">\n                <mat-datepicker-toggle matSuffix [for]=\"addDate\" [disabled]=\"dialogType === 'Viewer'\">\n                </mat-datepicker-toggle>\n                <mat-datepicker #addDate color=\"warn\" panelClass=\"custom-datepicker-color\"></mat-datepicker>\n            </mat-form-field>\n\n            <div *ngIf=\"dialogType === 'Editor'\" fxLayout=\"row\" fxLayoutAlign=\"start center\" fxLayoutGap=\"10px\">\n                <div fxFlex=\"none\">\n                    <strong>\u0E23\u0E2B\u0E31\u0E2A\u0E07\u0E1A\u0E1B\u0E23\u0E30\u0E21\u0E32\u0E13</strong>\n                </div>\n                <div fxFlex>\n                    <div class=\"w-100\" style.display=\"block\">\n                        <input matInput [formControl]=\"searchBudgetCode\" placeholder=\"\u0E23\u0E2B\u0E31\u0E2A\u0E07\u0E1A\u0E1B\u0E23\u0E30\u0E21\u0E32\u0E13\"\n                            class=\"input-search-code\">\n                        <!-- <mat-error>aofxta</mat-error> -->\n                    </div>\n                </div>\n                <div *ngIf=\"dialogType === 'Editor'\" fxFlex=\"none\">\n                    <button mat-flat-button [disabled]=\"isSaving || loadingSearch\" (click)=\"findingBudgetCode()\"\n                        [style.background-color]=\"'var(--primary-orange)'\">\n                        <mat-icon *ngIf=\"loadingSearch\">\n                            <mat-spinner [diameter]=\"24\"></mat-spinner>\n                        </mat-icon>\n                        <mat-icon *ngIf=\"!loadingSearch\">search</mat-icon>\n                        <strong>&nbsp;\u0E04\u0E49\u0E19\u0E2B\u0E32</strong>\n                    </button>\n                </div>\n            </div>\n            <div *ngIf=\"dialogType === 'Editor'\" [style.padding]=\"'5px 0'\" [style.min-height.px]=\"40\"\n                [style.overflow]=\"'hidden auto'\">\n                <!-- class=\"mat-chip-list-stacked\" -->\n                <small *ngIf=\"errFindMessage\" [style.color]=\"'var(--danger)'\">{{ errFindMessage }}</small>\n                <mat-chip-list *ngIf=\"listBudgetCode?.length\" aria-label=\"Color selection\">\n                    <ng-container *ngFor=\"let item of listBudgetCode\">\n                        <mat-chip (click)=\"setActiveBudgetCode(item)\"\n                            [selected]=\"item?.title === activeBudgetCode?.title\" [disabled]=\"isSaving\" color=\"accent\">\n                            <strong>{{ item?.budgetCode }}</strong>\n                            <small *ngIf=\"item?.assetCaption\">\n                                <i>({{ item?.assetCaption }})</i>\n                            </small>\n                            <span>&nbsp;</span>\n                            <mat-icon [style.color]=\"'#404040'\">vpn_key</mat-icon>\n                        </mat-chip>\n                    </ng-container>\n                </mat-chip-list>\n            </div>\n\n            <ng-container *ngIf=\"dialogType === 'Editor'\">\n                <div [style.margin-top.px]=\"16\">\n                    <strong [style.color]=\"'#404040'\">\u0E23\u0E32\u0E22\u0E01\u0E32\u0E23\u0E17\u0E23\u0E31\u0E1E\u0E22\u0E4C\u0E2A\u0E34\u0E19\u0E17\u0E35\u0E48\u0E43\u0E0A\u0E49\u0E23\u0E2B\u0E31\u0E2A\u0E07\u0E1A\u0E1B\u0E23\u0E30\u0E21\u0E32\u0E13</strong>\n                    <span fxFlex></span>\n                    <strong *ngIf=\"selectedOptions.value?.length\" [style.color]=\"'#404040'\">\n                        {{ selectedOptions.value?.length }} \u0E23\u0E32\u0E22\u0E01\u0E32\u0E23\n                    </strong>\n                </div>\n                <div class=\"w-100\">\n                    <mat-form-field appearance=\"none\" color=\"warn\" class=\"search-box-asset\">\n                        <input matInput [formControl]=\"searchAsset\" placeholder=\"\u0E23\u0E32\u0E22\u0E01\u0E32\u0E23\u0E17\u0E23\u0E31\u0E1E\u0E22\u0E4C\u0E2A\u0E34\u0E19...\">\n                        <mat-icon matSuffix>search</mat-icon>\n                    </mat-form-field>\n                </div>\n                <div fxFlex=\"grow\" [style.position]=\"'relative'\">\n                    <div class=\"w-100 h-100\" [style.position]=\"'absolute'\" [style.overflow-y]=\"'auto'\">\n                        <mat-selection-list dense color=\"warn\" [formControl]=\"selectedOptions\"\n                            (selectionChange)=\"selectionChanged($event)\">\n                            <ng-container *ngFor=\"let item of filteredAssets | async; last as isLast\">\n                                <mat-list-option checkboxPosition=\"before\" [value]=\"item\">\n                                    <div mat-line>\n                                        <strong>{{ item?.title }}</strong>\n                                    </div>\n                                    <div *ngIf=\"item?.linkpath_detail\" mat-line>\u0E17\u0E32\u0E07\u0E40\u0E0A\u0E37\u0E48\u0E2D\u0E21: {{ item?.linkpath_detail }}\n                                    </div>\n                                </mat-list-option>\n                                <mat-divider *ngIf=\"!isLast\"></mat-divider>\n                            </ng-container>\n                        </mat-selection-list>\n                    </div>\n                </div>\n            </ng-container>\n\n            <!--=== Asset in budget-code ===-->\n            <ng-container *ngIf=\"dialogType === 'Viewer' && activeBudgetCode?.budgetCode\">\n                <ng-container *ngTemplateOutlet=\"tempAssetListFoBudget\"></ng-container>\n            </ng-container>\n        </div>\n\n        <div fxLayout=\"column\" fxFlex=\"50%\" fxFlex.sm=\"35%\" class=\"h-100\" [style.padding-top.px]=\"4\">\n            <div fxLayout=\"row\" fxLayoutGap=\"16px\" class=\"w-100\">\n                <ng-container *ngIf=\"dialogType === 'Viewer'\">\n                    <strong>\u0E44\u0E1F\u0E25\u0E4C\u0E17\u0E35\u0E48\u0E41\u0E19\u0E1A\u0E21\u0E32</strong>\n                    <span fxFlex></span>\n                    <strong>{{ activeBudgetCode?.files?.length || 0 }} \u0E44\u0E1F\u0E25\u0E4C</strong>\n                </ng-container>\n\n                <ng-container *ngIf=\"dialogType === 'Editor'\">\n                    <button fxFlex=\"70%\" mat-flat-button (click)=\"fileMultiple.click()\" [disabled]=\"isSaving\"\n                        [style.background-color]=\"'var(--primary-orange)'\">\n                        <mat-icon>attach_file</mat-icon>\n                        <strong>\u0E41\u0E19\u0E1A\u0E44\u0E1F\u0E25\u0E4C</strong>\n                        <input #fileMultiple type=\"file\" name=\"file[]\" multiple (change)=\"inputFiles($event)\"\n                            style=\"display: none\">\n                    </button>\n\n                    <button fxFlex=\"30%\" mat-button>\n                        <strong>{{ filesUpload?.length }} \u0E44\u0E1F\u0E25\u0E4C</strong>\n                    </button>\n                </ng-container>\n            </div>\n\n            <div fxFlex=\"grow\" [style.position]=\"'relative'\">\n                <div class=\"w-100 h-100\" [style.position]=\"'absolute'\" [style.overflow-y]=\"'auto'\">\n                    <mat-list dense>\n                        <div *ngIf=\"filesUpload?.length\" [@fadeInGrow]>\n                            <ng-container *ngFor=\"let file of filesUpload; let idx = index;\">\n                                <mat-list-item>\n                                    <img matListAvatar [src]=\"file?.thumb\" [style.borderRadius.px]=\"5\">\n                                    <div matLine>{{ file?.name }}</div>\n                                    <div matLine>\n                                        <small>Size:&nbsp;{{ readFileSize(file?.size) }}</small>\n                                        <small fxFlex></small>\n                                        <small *ngIf=\"file?.progress && file?.progress < 100\">{{ file?.progress }}\n                                            %</small>\n                                    </div>\n                                    <div *ngIf=\"file?.progress > 0 && file?.progress < 100\" mat-line>\n                                        <mat-progress-bar mode=\"determinate\" [value]=\"file?.progress\" color=\"warn\">\n                                        </mat-progress-bar>\n                                    </div>\n                                    <mat-icon *ngIf=\"file?.progress === 100\" [style.color]=\"'var(--success)'\">\n                                        check_circle\n                                    </mat-icon>\n                                    <button *ngIf=\"!isSaving\" mat-icon-button matSuffix (click)=\"delFile(idx)\"\n                                        [style.color]=\"'gray'\">\n                                        <mat-icon>cancel</mat-icon>\n                                    </button>\n                                </mat-list-item>\n                            </ng-container>\n                        </div>\n\n                        <div *ngIf=\"activeBudgetCode?.files?.length\" [@fadeInGrow]>\n                            <ng-container *ngFor=\"let file of activeBudgetCode.files;\">\n                                <mat-list-item>\n                                    <img matListAvatar [src]=\"getFileIcon(file?.extension, file?.fileUrl)\"\n                                        [style.borderRadius.px]=\"5\">\n                                    <div matLine>&nbsp;&nbsp;{{ file?.fileName }}</div>\n                                    <div matLine>&nbsp;&nbsp;\n                                        <small>Size:&nbsp;{{ readFileSize(file?.size) }}</small>\n                                    </div>\n                                    <div *ngIf=\"file?.progress > 0 && file?.progress < 100\" mat-line>\n                                        <mat-progress-bar mode=\"determinate\" [value]=\"file?.progress\" color=\"warn\">\n                                        </mat-progress-bar>\n                                    </div>\n                                    <button mat-icon-button [style.color]=\"'gray'\"\n                                        [disabled]=\"file?.progress && file?.progress !== 100\"\n                                        (click)=\"downloafFile(file)\">\n                                        <mat-icon>download</mat-icon>\n                                    </button>\n                                </mat-list-item>\n                            </ng-container>\n                        </div>\n                    </mat-list>\n                </div>\n            </div>\n\n            <!--=== Asset in budget-code ===-->\n            <ng-container *ngIf=\"dialogType === 'Editor' && activeBudgetCode?.budgetCode\">\n                <ng-container *ngTemplateOutlet=\"tempAssetListFoBudget\"></ng-container>\n            </ng-container>\n        </div>\n    </div>\n</mat-dialog-content>\n\n<mat-dialog-actions *ngIf=\"dialogType === 'Editor'\">\n    <div fxLayout=\"row\" fxLayoutAlign=\"start center\" fxLayoutGap=\"16px\" [style.width.%]=\"100\">\n        <span fxFlex></span>\n\n        <button mat-button mat-dialog-close [disabled]=\"isSaving\">\n            <strong>\u0E22\u0E01\u0E40\u0E25\u0E34\u0E01</strong>\n        </button>\n\n        <div matTooltip=\"\u0E42\u0E1B\u0E23\u0E14\u0E23\u0E30\u0E1A\u0E38\u0E23\u0E2B\u0E31\u0E2A\u0E07\u0E1A\u0E1B\u0E23\u0E30\u0E21\u0E32\u0E13\" [matTooltipDisabled]=\"activeBudgetCode?.budgetCode\">\n            <button *ngIf=\"!isImageSaved()\"\n                [disabled]=\"!activeBudgetCode?.budgetCode\" mat-flat-button (click)=\"saveData()\"\n                [style.background-color]=\"'var(--primary-orange)'\">\n                <mat-icon *ngIf=\"isSaving\">\n                    <mat-spinner [diameter]=\"24\"></mat-spinner>\n                </mat-icon>\n                <strong *ngIf=\"!isSaving\">\u0E1A\u0E31\u0E19\u0E17\u0E36\u0E01</strong>\n            </button>\n        </div>\n\n        <button *ngIf=\"isSaved && isImageSaved()\" mat-flat-button [mat-dialog-close]=\"true\"\n            [style.background-color]=\"'var(--primary-orange)'\">\n            <strong>\u0E1B\u0E34\u0E14\u0E1F\u0E2D\u0E23\u0E4C\u0E21</strong>\n        </button>\n    </div>\n</mat-dialog-actions>\n\n<!--============================-->\n<!--=== Asset in budget-code ===-->\n<!--============================-->\n<ng-template #tempAssetListFoBudget>\n    <div>\n        <strong [style.color]=\"'#404040'\" [style.font-size.px]=\"14\">\u0E23\u0E32\u0E22\u0E01\u0E32\u0E23\u0E17\u0E23\u0E31\u0E1E\u0E22\u0E4C\u0E2A\u0E34\u0E19\u0E17\u0E35\u0E48\u0E43\u0E0A\u0E49\u0E23\u0E2B\u0E31\u0E2A\u0E07\u0E1A\u0E1B\u0E23\u0E30\u0E21\u0E32\u0E13: {{\n            activeBudgetCode?.budgetCode }}</strong>\n    </div>\n    <div fxFlex=\"grow\" [style.position]=\"'relative'\">\n        <div class=\"w-100 h-100\" [style.position]=\"'absolute'\" [style.overflow-y]=\"'auto'\">\n            <mat-list dense color=\"warn\">\n                <ng-container *ngFor=\"let item of assetsUseBudgetCode; last as isLast\">\n                    <div mat-subheader [style.font-size.px]=\"14\">\n                        <strong>{{ item?.caption }}</strong>\n                    </div>\n                    <mat-list-item *ngFor=\"let itemAss of item?.assets\">\n                        <mat-icon mat-list-icon [style.color]=\"'#404040'\">beenhere</mat-icon>\n                        <div mat-line>\n                            <strong>{{ itemAss?.title }}</strong>\n                        </div>\n                        <div *ngIf=\"itemAss?.description\" mat-line>{{ itemAss?.description }}</div>\n                    </mat-list-item>\n                    <mat-divider *ngIf=\"!isLast\"></mat-divider>\n                </ng-container>\n            </mat-list>\n        </div>\n    </div>\n</ng-template>",
                animations: [FadeInOut, FadeInGrow],
                providers: [{ provide: MAT_DATE_FORMATS, useValue: ɵ0 }],
                styles: [":host{position:relative;width:100%;height:100%}::ng-deep .dialog-add-code-budget mat-dialog-container{border-radius:12px;padding:16px;overflow:hidden}:host::ng-deep mat-form-field .mat-form-field-infix{padding:.5rem 0}:host::ng-deep mat-calendar.custom-datepicker-color .mat-calendar-body-selected{background-color:var(--primary-orange)!important;color:#fff;font-weight:700}:host::ng-deep mat-form-field.search-box-asset{width:100%}:host::ng-deep mat-form-field.search-box-asset .mat-form-field-wrapper{background-color:hsla(0,0%,82.7%,.8);border-radius:3px;padding:8px}:host::ng-deep mat-form-field.search-box-asset .mat-form-field-wrapper .mat-form-field-flex{padding:3px 16px;border-radius:30px;background-color:#fff}:host::ng-deep mat-form-field.search-box-asset .mat-form-field-infix{top:-.15rem;padding:0!important;border-top-width:0!important}:host::ng-deep mat-form-field.search-box-asset .mat-form-field-infix input{line-height:24px}:host::ng-deep mat-form-field.search-box-asset .mat-form-field-suffix{top:.15rem}.input-search-code{width:90%;border:2px solid #404040;border-radius:5px;padding:7px 10px}.input-search-code:disabled{border:1px solid rgba(64,64,64,.1)}:host::ng-deep .mat-list-base[dense] mat-list-option{min-height:40px}:host::ng-deep .mat-list-base[dense] mat-list-option mat-pseudo-checkbox.mat-pseudo-checkbox-checked{background-color:var(--primary-orange)}:host::ng-deep mat-spinner circle{stroke:#404040}"]
            },] }
];
AddBudgetCodeMaintenanceComponent.ctorParameters = () => [
    { type: ChangeDetectorRef },
    { type: NgZone },
    { type: MatDialogRef },
    { type: undefined, decorators: [{ type: Inject, args: [MAT_DIALOG_DATA,] }] },
    { type: DateAdapter },
    { type: UserAuthedService },
    { type: BudgetCodeService }
];
export { ɵ0 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWRkLWJ1ZGdldC1jb2RlLW1haW50ZW5hbmNlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3RpbWVsaW5lLWFzc2V0cy9zcmMvbGliL2NvbXBvbmVudHMvbWFpbi1kaWFsb2cvYWRkLWJ1ZGdldC1jb2RlLW1haW50ZW5hbmNlL2FkZC1idWRnZXQtY29kZS1tYWludGVuYW5jZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBVSxNQUFNLGVBQWUsQ0FBQztBQUNyRixPQUFPLEVBQUUsV0FBVyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3pELE9BQU8sRUFBRSxXQUFXLEVBQWtCLGdCQUFnQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDdkYsT0FBTyxFQUFFLFlBQVksRUFBRSxlQUFlLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUl6RSxPQUFPLEVBQUUsWUFBWSxFQUFFLG9CQUFvQixFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3pFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUN2RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUN4RSxPQUFPLEVBQUUsUUFBUSxFQUFFLGlCQUFpQixFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFDL0UsT0FBTyxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUVqRSxNQUFNLG1CQUFtQixHQUFtQjtJQUN4QyxLQUFLLEVBQUU7UUFDSCxTQUFTLEVBQUUsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRTtLQUNqRTtJQUNELE9BQU8sRUFBRTtR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LENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ3hFLENBQUM7OztZQXBTSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLGlDQUFpQztnQkFDM0MscWxlQUEyRDtnQkFFM0QsVUFBVSxFQUFFLENBQUMsU0FBUyxFQUFFLFVBQVUsQ0FBQztnQkFDbkMsU0FBUyxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsUUFBUSxJQUFxQixFQUFFLENBQUM7O2FBQzVFOzs7WUEzRFEsaUJBQWlCO1lBQXFCLE1BQU07WUFHNUMsWUFBWTs0Q0FvRlosTUFBTSxTQUFDLGVBQWU7WUFyRnRCLFdBQVc7WUFPWCxpQkFBaUI7WUFDUCxpQkFBaUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBJbmplY3QsIE5nWm9uZSwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBGb3JtQ29udHJvbCwgVmFsaWRhdG9ycyB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IERhdGVBZGFwdGVyLCBNYXREYXRlRm9ybWF0cywgTUFUX0RBVEVfRk9STUFUUyB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL2NvcmUnO1xuaW1wb3J0IHsgTWF0RGlhbG9nUmVmLCBNQVRfRElBTE9HX0RBVEEgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9kaWFsb2cnO1xuaW1wb3J0IHsgTWF0U2VsZWN0aW9uTGlzdENoYW5nZSB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL2xpc3QnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcy9pbnRlcm5hbC9TdWJzY3JpcHRpb24nO1xuaW1wb3J0IHsgZGVib3VuY2VUaW1lLCBkaXN0aW5jdFVudGlsQ2hhbmdlZCwgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnOyBcbmltcG9ydCB7IEljb25GaWxlcyB9IGZyb20gJy4uLy4uLy4uL2NvbW1vbi9pY29uLWZpbGVzJztcbmltcG9ydCB7IFVzZXJBdXRoZWRTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vc2VydmljZXMvdXNlci1hdXRoLnNlcnZpY2UnO1xuaW1wb3J0IHsgQXBwVG9vbHMsIEJ1ZGdldENvZGVTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vdGltZWxpbmUtYXNzZXRzLnNlcnZpY2UnO1xuaW1wb3J0IHsgRmFkZUluR3JvdywgRmFkZUluT3V0IH0gZnJvbSAnLi9jcmVhdGUtZXZlbnQuYW5pbWF0aW9uJztcblxuY29uc3QgQ1VTVE9NX0RBVEVfRk9STUFUUzogTWF0RGF0ZUZvcm1hdHMgPSB7XG4gICAgcGFyc2U6IHtcbiAgICAgICAgZGF0ZUlucHV0OiB7IG1vbnRoOiAnc2hvcnQnLCB5ZWFyOiAnbnVtZXJpYycsIGRheTogJ251bWVyaWMnIH0sXG4gICAgfSxcbiAgICBkaXNwbGF5OiB7XG4gICAgICAgIGRhdGVJbnB1dDogeyBtb250aDogJ3Nob3J0JywgeWVhcjogJ251bWVyaWMnLCBkYXk6ICdudW1lcmljJyB9LFxuICAgICAgICBtb250aFllYXJMYWJlbDogeyB5ZWFyOiAnbnVtZXJpYycsIG1vbnRoOiAnbnVtZXJpYycgfSxcbiAgICAgICAgZGF0ZUExMXlMYWJlbDogeyB5ZWFyOiAnbnVtZXJpYycsIG1vbnRoOiAnbG9uZycsIGRheTogJ251bWVyaWMnIH0sXG4gICAgICAgIG1vbnRoWWVhckExMXlMYWJlbDogeyB5ZWFyOiAnbnVtZXJpYycsIG1vbnRoOiAnbG9uZycgfSxcbiAgICB9XG59O1xuXG5pbnRlcmZhY2UgRGlhbG9nRGF0YUludGVyZmFjZSB7XG4gICAgdGl0bGU6IHN0cmluZztcbiAgICBhc3NldFRhYmxlOiBzdHJpbmc7XG4gICAgZGlhbG9nVHlwZTogJ0VkaXRvcicgfCAnVmlld2VyJztcbiAgICBsaXN0R2VvbTogQXJyYXk8YW55PjtcbiAgICBidWRnZXRDb2RlOiBzdHJpbmc7XG59XG5pbnRlcmZhY2UgRmlsZUl0ZW0ge1xuICAgIG5hbWU6IHN0cmluZztcbiAgICB0aHVtYjogc3RyaW5nIHwgQXJyYXlCdWZmZXI7XG4gICAgZmlsZTogRmlsZTtcbiAgICBzaXplOiBudW1iZXI7XG4gICAgcHJvZ3Jlc3M/OiBudW1iZXI7XG59XG5pbnRlcmZhY2UgQnVkZ2V0Q29kZUxpc3RJbnRlcmZhY2Uge1xuICAgIHRpdGxlOiBzdHJpbmc7XG4gICAgYnVkZ2V0Q29kZTogc3RyaW5nO1xuICAgIHJlcG9ydERhdGU6IHN0cmluZztcbiAgICBhc3NldElkczogQXJyYXk8c3RyaW5nPjtcbiAgICBmaWxlczogQXJyYXk8e1xuICAgICAgICBmaWxlVXJsOiBzdHJpbmcsXG4gICAgICAgIGZpbGVOYW1lOiBzdHJpbmcsXG4gICAgICAgIGV4dGVuc2lvbjogc3RyaW5nLFxuICAgICAgICBzaXplOiBudW1iZXIsXG4gICAgICAgIHByb2dyZXNzPzogbnVtYmVyXG4gICAgfT47XG4gICAgc2VsZWN0ZWQ/OiBib29sZWFuO1xufVxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdhcHAtYWRkLWJ1ZGdldC1jb2RlLW1haW50ZW5hbmNlJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vYWRkLWJ1ZGdldC1jb2RlLW1haW50ZW5hbmNlLmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9hZGQtYnVkZ2V0LWNvZGUtbWFpbnRlbmFuY2UuY29tcG9uZW50LnNjc3MnXSxcbiAgICBhbmltYXRpb25zOiBbRmFkZUluT3V0LCBGYWRlSW5Hcm93XSxcbiAgICBwcm92aWRlcnM6IFt7IHByb3ZpZGU6IE1BVF9EQVRFX0ZPUk1BVFMsIHVzZVZhbHVlOiBDVVNUT01fREFURV9GT1JNQVRTIH1dXG59KVxuZXhwb3J0IGNsYXNzIEFkZEJ1ZGdldENvZGVNYWludGVuYW5jZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gICAgcHVibGljIHRpdGxlOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBhc3NldFRhYmxlOiBzdHJpbmc7XG4gICAgcHVibGljIGRpYWxvZ1R5cGU6ICdFZGl0b3InIHwgJ1ZpZXdlcicgPSAnVmlld2VyJztcbiAgICBwdWJsaWMgY3VycmVudERhdGU6IEZvcm1Db250cm9sID0gbmV3IEZvcm1Db250cm9sKG5ldyBEYXRlKCksIFtWYWxpZGF0b3JzLnJlcXVpcmVkXSk7XG4gICAgcHVibGljIHNlYXJjaEJ1ZGdldENvZGU6IEZvcm1Db250cm9sID0gbmV3IEZvcm1Db250cm9sKG51bGwsIFtWYWxpZGF0b3JzLnJlcXVpcmVkXSk7XG4gICAgcHVibGljIHNlYXJjaEFzc2V0OiBGb3JtQ29udHJvbCA9IG5ldyBGb3JtQ29udHJvbChudWxsKTtcbiAgICBwdWJsaWMgc2VsZWN0ZWRPcHRpb25zOiBGb3JtQ29udHJvbCA9IG5ldyBGb3JtQ29udHJvbChuZXcgQXJyYXkoKSwgW1ZhbGlkYXRvcnMucmVxdWlyZWRdKTtcbiAgICBwdWJsaWMgbGlzdEJ1ZGdldENvZGU6IEJ1ZGdldENvZGVMaXN0SW50ZXJmYWNlW10gPSBuZXcgQXJyYXkoKTtcbiAgICBwdWJsaWMgYXNzZXRzVXNlQnVkZ2V0Q29kZTogQXJyYXk8YW55PiA9IG5ldyBBcnJheSgpO1xuICAgIC8vIHB1YmxpYyBsaXN0R2VvbUNvcHk6IEFycmF5PGFueT4gPSBuZXcgQXJyYXkoKTtcbiAgICBwdWJsaWMgbGlzdEdlb206IEFycmF5PGFueT4gPSBuZXcgQXJyYXkoKTtcbiAgICBwdWJsaWMgZmlsdGVyZWRBc3NldHM6IE9ic2VydmFibGU8QXJyYXk8YW55Pj47XG4gICAgcHVibGljIGZpbGVzVXBsb2FkOiBBcnJheTxGaWxlSXRlbT4gPSBuZXcgQXJyYXkoKTtcbiAgICBwdWJsaWMgYWN0aXZlQnVkZ2V0Q29kZTogQnVkZ2V0Q29kZUxpc3RJbnRlcmZhY2U7XG4gICAgLyoqIFNhdmUgc3RhdGUgKi9cbiAgICBwdWJsaWMgaXNTYXZpbmc6IGJvb2xlYW47XG4gICAgcHVibGljIGlzU2F2ZWQ6IGJvb2xlYW47XG4gICAgcHVibGljIHByZUxvYWRpbmc6IGJvb2xlYW47XG4gICAgcHVibGljIGxvYWRpbmdTZWFyY2g6IGJvb2xlYW47XG4gICAgcHVibGljIGVyckZpbmRNZXNzYWdlOiBzdHJpbmc7XG4gICAgLyoqIFN1YnNjcmlwdGlvbiAqL1xuICAgIHByaXZhdGUgX3N1YnNjcmlwdGlvbjogeyBbeDogc3RyaW5nXTogU3Vic2NyaXB0aW9uIH0gPSB7fTtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSBfcmVmOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICAgICAgcHJpdmF0ZSBfem9uZTogTmdab25lLFxuICAgICAgICBwcml2YXRlIF9kaWFsb2c6IE1hdERpYWxvZ1JlZjxBZGRCdWRnZXRDb2RlTWFpbnRlbmFuY2VDb21wb25lbnQ+LFxuICAgICAgICBASW5qZWN0KE1BVF9ESUFMT0dfREFUQSkgZGF0YTogRGlhbG9nRGF0YUludGVyZmFjZSxcbiAgICAgICAgcHJpdmF0ZSBfZGF0ZUFkYXB0ZXI6IERhdGVBZGFwdGVyPGFueT4sXG4gICAgICAgIHByaXZhdGUgX2F1dGhlZDogVXNlckF1dGhlZFNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgX2J1ZGdldENvZGVBUEk6IEJ1ZGdldENvZGVTZXJ2aWNlXG4gICAgKSB7XG4gICAgICAgIHRoaXMuX2RhdGVBZGFwdGVyLnNldExvY2FsZSgndGgtVEgnKTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ0RpYWxvZy1EYXRhOicsIGRhdGEpO1xuICAgICAgICB0aGlzLnRpdGxlID0gZGF0YT8udGl0bGU7XG4gICAgICAgIHRoaXMuYXNzZXRUYWJsZSA9IGRhdGE/LmFzc2V0VGFibGU7XG4gICAgICAgIHRoaXMuZGlhbG9nVHlwZSA9IGRhdGE/LmRpYWxvZ1R5cGU7XG4gICAgICAgIHRoaXMubGlzdEdlb20gPSB0aGlzLm1hcEZvcm1hdChkYXRhPy5saXN0R2VvbSk7XG4gICAgICAgIGlmIChkYXRhPy5idWRnZXRDb2RlKSB0aGlzLmdldFZpZXdCdWRnZXRDb2RlKGRhdGE/LmJ1ZGdldENvZGUpO1xuICAgICAgICAvLyB0aGlzLmxpc3RHZW9tQ29weSA9IHRoaXMubGlzdEdlb20uZmlsdGVyKG8gPT4gbz8uaWQpO1xuICAgICAgICAvLyBjb25zdCBzZWxlY3RlZCA9IHRoaXMubGlzdEdlb20uZmlsdGVyKG8gPT4gWzc0MDcsIDc0MTAsIDc0MTJdLmluY2x1ZGVzKG8/LmlkKSk7XG4gICAgICAgIC8vIHRoaXMuc2VsZWN0ZWRPcHRpb25zLnNldFZhbHVlKHNlbGVjdGVkKTtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5maWx0ZXJlZEFzc2V0cyA9IHRoaXMuc2VhcmNoQXNzZXQudmFsdWVDaGFuZ2VzLnBpcGUoXG4gICAgICAgICAgICBkZWJvdW5jZVRpbWUoNDAwKSxcbiAgICAgICAgICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKCksXG4gICAgICAgICAgICBtYXAodmFsdWUgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGtleXdvcmQ6IHN0cmluZyA9IHZhbHVlLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgaWYgKGtleXdvcmQ/Lmxlbmd0aCkgcmV0dXJuIHRoaXMubGlzdEdlb20uZmlsdGVyKG9iaiA9PiBvYmoudGl0bGUudG9Mb3dlckNhc2UoKS5pbmRleE9mKGtleXdvcmQpICE9PSAtMSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubGlzdEdlb20uc2xpY2UoKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgfVxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zZWFyY2hBc3NldC5zZXRWYWx1ZSgnJywgeyBlbWl0RXZlbnQ6IHRydWUgfSk7IC8vLS0gVHJpZ2dlciBhc3NldCBzZWFyY2ggYm94XG4gICAgICAgIHRoaXMuX3N1YnNjcmlwdGlvbi5zZWFyY2hCdWRnZXRDb2RlID0gdGhpcy5zZWFyY2hCdWRnZXRDb2RlLnZhbHVlQ2hhbmdlcy5waXBlKFxuICAgICAgICAgICAgZGVib3VuY2VUaW1lKDQwMCksXG4gICAgICAgICAgICBkaXN0aW5jdFVudGlsQ2hhbmdlZCgpLFxuICAgICAgICApLnN1YnNjcmliZSh2YWx1ZSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVCdWRnZXRDb2RlPy5idWRnZXRDb2RlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVCdWRnZXRDb2RlID0gbnVsbDtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkT3B0aW9ucy5zZXRWYWx1ZShbXSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fcmVmLmRldGVjdENoYW5nZXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgICAgICB0aGlzLl9kYXRlQWRhcHRlci5zZXRMb2NhbGUoJ2VuLUVOJyk7XG4gICAgICAgIGZvciAoY29uc3Qga2V5IGluIHRoaXMuX3N1YnNjcmlwdGlvbikge1xuICAgICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0aGlzLl9zdWJzY3JpcHRpb24sIGtleSkpIHRoaXMuX3N1YnNjcmlwdGlvbltrZXldLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIG1hcEZvcm1hdChhcnI6IEFycmF5PGFueT4pOiBBcnJheTxhbnk+IHtcbiAgICAgICAgcmV0dXJuIGFyci5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzQSA9IChhPy5za20pID8gTnVtYmVyKFN0cmluZyhhPy5za20pLnJlcGxhY2UoJysnLCAnLicpKSA6IE51bWJlcihTdHJpbmcoYT8ua21fbG9jYXRpb24pLnJlcGxhY2UoJysnLCAnLicpKTtcbiAgICAgICAgICAgIGNvbnN0IHNCID0gKGI/LnNrbSkgPyBOdW1iZXIoU3RyaW5nKGI/LnNrbSkucmVwbGFjZSgnKycsICcuJykpIDogTnVtYmVyKFN0cmluZyhiPy5rbV9sb2NhdGlvbikucmVwbGFjZSgnKycsICcuJykpO1xuICAgICAgICAgICAgcmV0dXJuIChzQiA8IHNBKSA/IDEgOiAtMTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqIEhhbmRsZXIgRm9ybSAqL1xuICAgIHByaXZhdGUgc2V0Rm9ybURpc2FibGVkKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmN1cnJlbnREYXRlLmRpc2FibGUoKTtcbiAgICAgICAgdGhpcy5zZWFyY2hCdWRnZXRDb2RlLmRpc2FibGUoKTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZE9wdGlvbnMuZGlzYWJsZSgpO1xuICAgIH1cbiAgICBwcml2YXRlIHNldEZvcm1FbmFibGVkKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmN1cnJlbnREYXRlLmVuYWJsZSgpO1xuICAgICAgICB0aGlzLnNlYXJjaEJ1ZGdldENvZGUuZW5hYmxlKCk7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRPcHRpb25zLmVuYWJsZSgpO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRWaWV3QnVkZ2V0Q29kZShidWRnZXRDb2RlOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5wcmVMb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fYnVkZ2V0Q29kZUFQSS5maW5kQnVkZ2V0Q29kZShmYWxzZSwgdGhpcy5hc3NldFRhYmxlLCBidWRnZXRDb2RlKS50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgICBpZiAocmVzPy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEFjdGl2ZUJ1ZGdldENvZGUocmVzWzBdKTtcbiAgICAgICAgICAgICAgICBjb25zdCByZXBvcnREYXRlID0gcmVzWzBdPy5yZXBvcnREYXRlO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoQnVkZ2V0Q29kZS5zZXRWYWx1ZShidWRnZXRDb2RlLCB7IGVtaXRFdmVudDogZmFsc2UgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50RGF0ZS5zZXRWYWx1ZShuZXcgRGF0ZShyZXBvcnREYXRlKSwgeyBlbWl0RXZlbnQ6IGZhbHNlIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5wcmVMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIH0sIGVyciA9PiB7XG4gICAgICAgICAgICB0aGlzLnByZUxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHB1YmxpYyBmaW5kaW5nQnVkZ2V0Q29kZSgpIHtcbiAgICAgICAgdGhpcy5sb2FkaW5nU2VhcmNoID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fYnVkZ2V0Q29kZUFQSS5maW5kQnVkZ2V0Q29kZSh0cnVlLCB0aGlzLmFzc2V0VGFibGUsIHRoaXMuc2VhcmNoQnVkZ2V0Q29kZS52YWx1ZSkudGhlbihyZXMgPT4ge1xuICAgICAgICAgICAgdGhpcy5saXN0QnVkZ2V0Q29kZSA9IChyZXM/Lmxlbmd0aCkgPyByZXMgOiBbXTtcbiAgICAgICAgICAgIHRoaXMubG9hZGluZ1NlYXJjaCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5lcnJGaW5kTWVzc2FnZSA9IG51bGw7XG4gICAgICAgIH0sIGVyciA9PiB7XG4gICAgICAgICAgICB0aGlzLmVyckZpbmRNZXNzYWdlID0gJ+C5hOC4oeC5iOC4nuC4muC4o+C4q+C4seC4quC4h+C4m+C4o+C4sOC4oeC4suC4kyc7XG4gICAgICAgICAgICB0aGlzLmxpc3RCdWRnZXRDb2RlID0gbmV3IEFycmF5KCk7XG4gICAgICAgICAgICB0aGlzLmxvYWRpbmdTZWFyY2ggPSBmYWxzZTtcbiAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUJ1ZGdldENvZGU/LmJ1ZGdldENvZGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUJ1ZGdldENvZGUgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRPcHRpb25zLnNldFZhbHVlKFtdKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9yZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgcHJpdmF0ZSBnZXRBc3NldFVzZWRDb2RlKCk6IHZvaWQge1xuICAgICAgICB0aGlzLnByZUxvYWRpbmcgPSB0cnVlO1xuICAgICAgICB0aGlzLl9idWRnZXRDb2RlQVBJLmdldEFzc2V0VXNlZENvZGUodGhpcy5hY3RpdmVCdWRnZXRDb2RlPy5idWRnZXRDb2RlKS50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgICB0aGlzLmFzc2V0c1VzZUJ1ZGdldENvZGUgPSAocmVzPy5sZW5ndGgpID8gcmVzIDogW107XG4gICAgICAgICAgICBpZiAocmVzPy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBsZXQgYXNzZXRJZHMgPSB0aGlzLmFzc2V0c1VzZUJ1ZGdldENvZGUuZmlsdGVyKG8gPT4gKG8/LmFzc2V0VGFibGUgPT09IHRoaXMuYXNzZXRUYWJsZSAmJiBvPy5hc3NldHM/Lmxlbmd0aCkpLm1hcChvID0+IG8uYXNzZXRzKTtcbiAgICAgICAgICAgICAgICBhc3NldElkcyA9IChhc3NldElkcz8ubGVuZ3RoID4gMCkgPyBhc3NldElkc1swXS5tYXAobyA9PiBvLmFzc2V0SWQpIDogW107XG4gICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWQgPSB0aGlzLmxpc3RHZW9tLmZpbHRlcihvID0+IGFzc2V0SWRzLmluY2x1ZGVzKG8/LmlkKSk7XG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkPy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZE9wdGlvbnMuc2V0VmFsdWUoc2VsZWN0ZWQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucHJlTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICB9LCBlcnIgPT4ge1xuICAgICAgICAgICAgdGhpcy5wcmVMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBwdWJsaWMgc2V0QWN0aXZlQnVkZ2V0Q29kZShidWRnZXRDb2RlOiBCdWRnZXRDb2RlTGlzdEludGVyZmFjZSk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5hY3RpdmVCdWRnZXRDb2RlPy50aXRsZSA9PT0gYnVkZ2V0Q29kZT8udGl0bGUpIHtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlQnVkZ2V0Q29kZSA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkT3B0aW9ucy5zZXRWYWx1ZShbXSk7XG4gICAgICAgICAgICB0aGlzLl9yZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYWN0aXZlQnVkZ2V0Q29kZSA9IGJ1ZGdldENvZGU7XG4gICAgICAgIHRoaXMuZ2V0QXNzZXRVc2VkQ29kZSgpO1xuICAgICAgICBjb25zdCBhc3NldElkcyA9IChidWRnZXRDb2RlPy5hc3NldElkcz8ubGVuZ3RoKSA/IGJ1ZGdldENvZGUuYXNzZXRJZHMgOiBbXTtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWQgPSB0aGlzLmxpc3RHZW9tLmZpbHRlcihvID0+IGFzc2V0SWRzLmluY2x1ZGVzKFN0cmluZyhvPy5pZCkpKTtcbiAgICAgICAgaWYgKHNlbGVjdGVkPy5sZW5ndGgpIHRoaXMuc2VsZWN0ZWRPcHRpb25zLnNldFZhbHVlKHNlbGVjdGVkKTtcbiAgICB9XG5cbiAgICAvKiogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICogRmlsZSBoYW5kbGVyaW5nXG4gICAgICAgKiBAcGFyYW0gZWwgXG4gICAgICAgKi9cbiAgICBwdWJsaWMgaW5wdXRGaWxlcyhlbDogYW55KSB7XG4gICAgICAgIGNvbnN0IGZpbGVzOiBBcnJheTxGaWxlPiA9IGVsLnRhcmdldC5maWxlcztcbiAgICAgICAgY29uc3QgZmlsZXNBcnI6IEFycmF5PEZpbGVJdGVtPiA9IG5ldyBBcnJheTxGaWxlSXRlbT4oKTtcbiAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKSB7XG4gICAgICAgICAgICBjb25zdCBleHRlbnNpb246IHN0cmluZyA9IFN0cmluZyhmaWxlLm5hbWUpLnN1YnN0cmluZyhTdHJpbmcoZmlsZS5uYW1lKS5sYXN0SW5kZXhPZignLicpICsgMSk7XG4gICAgICAgICAgICBjb25zdCB0eXBlOiBzdHJpbmcgPSBTdHJpbmcoZmlsZS50eXBlKS5zcGxpdCgnLycpWzBdO1xuXG4gICAgICAgICAgICBjb25zdCBmb3JtYXQ6IEZpbGVJdGVtID0ge1xuICAgICAgICAgICAgICAgIHRodW1iOiBudWxsLFxuICAgICAgICAgICAgICAgIG5hbWU6IGZpbGUubmFtZSxcbiAgICAgICAgICAgICAgICBmaWxlOiBmaWxlLFxuICAgICAgICAgICAgICAgIHNpemU6IGZpbGUuc2l6ZSxcbiAgICAgICAgICAgICAgICBwcm9ncmVzczogMFxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZmlsZS50eXBlLm1hdGNoKC9pbWFnZVxcLyovKSAmJiB0eXBlICE9ICdzdmcnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZWFkSW1hZ2UoZm9ybWF0KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZm9ybWF0LnRodW1iID0gSWNvbkZpbGVzLmljb25GaWxlKFN0cmluZyhleHRlbnNpb24pLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZmlsZXNBcnIudW5zaGlmdChmb3JtYXQpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fem9uZS5ydW4oYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5maWxlc1VwbG9hZCA9IFsuLi5maWxlc0FyciwgLi4udGhpcy5maWxlc1VwbG9hZF07XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKiogUmVhbmRlciBpbWFnZSBmaWxlICovXG4gICAgcHJpdmF0ZSByZWFkSW1hZ2UoZmlsZTogRmlsZUl0ZW0pIHtcbiAgICAgICAgbGV0IHByZXZpZXdVcmw6IHN0cmluZyB8IEFycmF5QnVmZmVyID0gJydcbiAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgICAgcmVhZGVyLm9ubG9hZCA9IChfZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGZpbGUudGh1bWIgPSByZWFkZXIucmVzdWx0XG4gICAgICAgIH1cbiAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZS5maWxlKTtcbiAgICAgICAgcmV0dXJuIGZpbGU7XG4gICAgfVxuICAgIC8qKiBEaXNwbGF5IHNpemUgdHlwZVxuICAgICAqIDEwIEtCIHwgTUIgfCBHQlxuICAgICovXG4gICAgcHVibGljIHJlYWRGaWxlU2l6ZShzaXplOiBudW1iZXIpOiBzdHJpbmcge1xuICAgICAgICBpZiAoIXNpemUpIHJldHVybiAnJztcbiAgICAgICAgaWYgKHNpemUgPD0gKCgyICoqIDEwKSAqIDEwMjQpKSByZXR1cm4gYCR7KHNpemUgLyAoMiAqKiAxMCkpLnRvRml4ZWQoMil9IEtCYDtcbiAgICAgICAgaWYgKHNpemUgPD0gKCgyICoqIDIwKSAqIDEwMjQpKSByZXR1cm4gYCR7KHNpemUgLyAoMiAqKiAyMCkpLnRvRml4ZWQoMil9IE1CYDtcbiAgICAgICAgcmV0dXJuIGAkeyhzaXplIC8gKDIgKiogMzApKS50b0ZpeGVkKDIpfSBHQmA7XG4gICAgfVxuICAgIC8qKiBWaWV3IGV4dGVudGlvbiAqL1xuICAgIHB1YmxpYyBnZXRGaWxlSWNvbihleHRlbnNpb246IHN0cmluZywgZmlsZVVybD86IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IGlzSW1hZ2U6IGJvb2xlYW4gPSBbJ2pwZycsICdwbmcnLCAnanBlZycsICdnaWYnLCAnc3ZnJ10uaW5jbHVkZXMoU3RyaW5nKGV4dGVuc2lvbikudG9Mb3dlckNhc2UoKSk7XG4gICAgICAgIGlmIChpc0ltYWdlICYmIGZpbGVVcmwpIHJldHVybiBmaWxlVXJsO1xuICAgICAgICByZXR1cm4gSWNvbkZpbGVzLmljb25GaWxlKFN0cmluZyhleHRlbnNpb24pLnRvTG93ZXJDYXNlKCkpO1xuICAgIH1cbiAgICAvKiogRGVsZXRlIGZpbGUgaXRlbSAqL1xuICAgIHB1YmxpYyBkZWxGaWxlKHBvc2l0aW9uOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5maWxlc1VwbG9hZC5zcGxpY2UocG9zaXRpb24sIDEpO1xuICAgIH1cblxuICAgIC8qKiBTZWxlY3QgaXRlbSAqL1xuICAgIHB1YmxpYyBzZWxlY3Rpb25DaGFuZ2VkKHNlbGVjdGVkOiBNYXRTZWxlY3Rpb25MaXN0Q2hhbmdlKSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCdzZWxlY3RlZDonLCBzZWxlY3RlZCwgdGhpcy5zZWxlY3RlZE9wdGlvbnMudmFsdWUpO1xuICAgIH1cblxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgcHVibGljIGlzSW1hZ2VTYXZlZCgpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKHRoaXMuaXNTYXZlZCAmJiAhdGhpcy5maWxlc1VwbG9hZD8ubGVuZ3RoKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgaWYgKCF0aGlzLmZpbGVzVXBsb2FkPy5sZW5ndGgpIHJldHVybiBmYWxzZTtcbiAgICAgICAgY29uc3Qgc2F2aW5nID0gdGhpcy5maWxlc1VwbG9hZC5ldmVyeShvID0+IG8ucHJvZ3Jlc3MgPT0gMTAwKTtcbiAgICAgICAgcmV0dXJuIHNhdmluZztcbiAgICB9XG4gICAgcHVibGljIHNhdmVEYXRhKCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5pc1NhdmluZykgcmV0dXJuO1xuICAgICAgICBpZiAoIXRoaXMuc2VsZWN0ZWRPcHRpb25zLnZhbHVlPy5sZW5ndGgpIHJldHVybjtcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudERhdGUuaW52YWxpZCB8fCB0aGlzLnNlYXJjaEJ1ZGdldENvZGUuaW52YWxpZCkgcmV0dXJuO1xuICAgICAgICBjb25zdCB0b29scyA9IG5ldyBBcHBUb29scygpO1xuXG4gICAgICAgIGNvbnN0IGFzc2V0SWRzOiBBcnJheTxzdHJpbmc+ID0gdGhpcy5zZWxlY3RlZE9wdGlvbnMudmFsdWUuZmlsdGVyKG8gPT4gKG8/LmlkKSkubWFwKG8gPT4gU3RyaW5nKG8/LmlkKSk7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCdBc3NldC1JZHM6JywgdGhpcy5hc3NldFRhYmxlLCB0aGlzLnNlYXJjaEJ1ZGdldENvZGUudmFsdWUsIGFzc2V0SWRzKTtcbiAgICAgICAgY29uc3QgYnVkZ2V0Q29kZTogc3RyaW5nID0gdGhpcy5hY3RpdmVCdWRnZXRDb2RlPy5idWRnZXRDb2RlID8/IHRoaXMuc2VhcmNoQnVkZ2V0Q29kZS52YWx1ZTtcbiAgICAgICAgY29uc3QgcGFyYW1zID0ge1xuICAgICAgICAgICAgYXNzZXRUeXBlOiB0aGlzLmFzc2V0VGFibGUsXG4gICAgICAgICAgICBidWRnZXRDb2RlOiBTdHJpbmcoYnVkZ2V0Q29kZSkudHJpbSgpLFxuICAgICAgICAgICAgYXNzZXRJZHM6IGFzc2V0SWRzLFxuICAgICAgICAgICAgdXNlcklkOiB0aGlzLl9hdXRoZWQuYXV0aFVzZXI/LmFjY291bnRfaWQsXG4gICAgICAgICAgICByZXBvcnREYXRlOiB0b29scy5kYXRlVGltZUZvcm1hdCh0aGlzLmN1cnJlbnREYXRlLnZhbHVlKVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmlzU2F2aW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zZXRGb3JtRGlzYWJsZWQoKTtcbiAgICAgICAgLy8gcmV0dXJuO1xuICAgICAgICBjb25zb2xlLmxvZygnQXNzZXQtSWRzOicsIHBhcmFtcyk7XG4gICAgICAgIHRoaXMuX2J1ZGdldENvZGVBUEkuY3JlYXRlV2l0aFVwZGF0ZShwYXJhbXMpLnRoZW4ocmVzID0+IHtcbiAgICAgICAgICAgIHRoaXMuaXNTYXZlZCA9IHRydWU7XG4gICAgICAgICAgICBpZiAocmVzPy5idWRnZXRfY29kZSkgdGhpcy51cGxvYWRBbGxGaWxlKHJlcz8uYnVkZ2V0X2NvZGUpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgcHJpdmF0ZSB1cGxvYWRBbGxGaWxlKGJ1ZGdldENvZGU6IHN0cmluZykge1xuICAgICAgICBsZXQgaWR4RmlsZSA9IDA7XG4gICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiB0aGlzLmZpbGVzVXBsb2FkKSB7XG4gICAgICAgICAgICB0aGlzLl9zdWJzY3JpcHRpb25bYHVwbG9hZC1pZHgtJHtpZHhGaWxlfWBdID0gdGhpcy5fYnVkZ2V0Q29kZUFQSS51cGxvYWRGaWxlKHRoaXMuYXNzZXRUYWJsZSwgYnVkZ2V0Q29kZSwgaXRlbS5maWxlKS5zdWJzY3JpYmUocmVzID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHJlcyA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5wcm9ncmVzcyA9IHJlcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBlcnIgPT4gY29uc29sZS5sb2coJyVjRXJyb3Igb2NjdXJlZCB3aGlsZSB1cGxvYWRpbmcgZmlsZScsICdjb2xvcjp0b21hdG8nKSk7XG4gICAgICAgICAgICBpZHhGaWxlKys7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHVibGljIGRvd25sb2FmRmlsZShmaWxlOiBhbnkpIHtcbiAgICAgICAgY29uc3QgZXh0cmFjdDogc3RyaW5nW10gPSBTdHJpbmcoZmlsZT8uZmlsZVVybCkuc3BsaXQoJy8nKTtcbiAgICAgICAgY29uc3QgZmlsZU5hbWUgPSBleHRyYWN0W2V4dHJhY3QubGVuZ3RoIC0gMV07XG4gICAgICAgIHRoaXMuX3N1YnNjcmlwdGlvbi5kb3dubG9hZEZpbGUgPSB0aGlzLl9idWRnZXRDb2RlQVBJLmRvd25sb2FkRmlsZSh0aGlzLmFzc2V0VGFibGUsIGZpbGVOYW1lKS5zdWJzY3JpYmUocmVzID0+IHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgcmVzID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgICAgIGZpbGUucHJvZ3Jlc3MgPSBNYXRoLnJvdW5kKDEwMCAqIHJlcyAvIE51bWJlcihmaWxlPy5zaXplKSk7Ly9jb25zb2xlLmxvZygnUGVyY2VudGFnOicsIE1hdGgucm91bmQoMTAwICogcmVzIC8gTnVtYmVyKGZpbGU/LnNpemUpKSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHJlcyBpbnN0YW5jZW9mIEJsb2IpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRvd25sb2FkQmxvYihyZXMsIGZpbGU/LmZpbGVOYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHByaXZhdGUgZG93bmxvYWRCbG9iKGJsb2I6IEJsb2IsIGZpbGVuYW1lPzogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYilcbiAgICAgICAgY29uc3QgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKVxuICAgICAgICBhLmhyZWYgPSB1cmxcbiAgICAgICAgYS5kb3dubG9hZCA9IGZpbGVuYW1lIHx8ICdkb3dubG9hZCdcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKVxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsgYS5jbGljaygpOyBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGEpOyB9LCAxMDApO1xuICAgIH1cbn1cbiJdfQ==